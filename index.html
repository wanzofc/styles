<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegraph</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }

        .container {
            margin-top: 50px;
        }

        .upload-card {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .upload-card h2 {
            margin-bottom: 20px;
        }

        .result-area {
            margin-top: 20px;
            display: none;
        }

        .result-input {
            width: calc(100% - 60px);
            display: inline-block;
            margin-right: 10px;
            border: 1px solid #ddd;
            padding: 0.375rem 0.75rem;
            border-radius: 4px;
        }

        .progress-bar {
            transition: width 0.3s ease
        }

        .skeleton-loader {
            background-color: #f2f2f2;
            border-radius: 6px;
            margin-bottom: 10px;
            overflow: hidden;
            position: relative;
        }

        .skeleton-loader.skeleton-title {
            height: 30px;
            margin-bottom: 20px;
            width: 50%;
        }

        .skeleton-loader.skeleton-input {
            height: 40px;
            width: 100%;
        }

        .skeleton-loader.skeleton-button {
            height: 45px;
            width: 100%;
        }

        .skeleton-loader::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 200%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shimmer 1.5s linear infinite;
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.32/dist/sweetalert2.min.css">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>

<body>
    <div id="skeleton-container" class="container" data-aos="fade-up" data-aos-duration="1000" style="display: none">
        <div class="row justify-center">
            <div class="col-md-6 animate__animated animate__fadeIn">
                <div class="upload-card bg-white shadow-md rounded-lg p-5">
                    <div class="skeleton-loader skeleton-title"></div>
                    <div class="skeleton-loader skeleton-input"></div>
                    <div class="skeleton-loader skeleton-button"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="container" data-aos="fade-up" data-aos-duration="1000">
        <div class="row justify-center">
            <div class="col-md-6 animate__animated animate__fadeIn">
                <div class="upload-card bg-white shadow-md rounded-lg p-5">
                    <h2 class="text-center text-2xl font-bold mb-5">telegraph by wanzofc</h2>
                    <div id="upload-progress" class="progress mb-3" style="display: none;">
                        <div class="progress-bar bg-blue-500 text-white text-center" role="progressbar"
                            style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
                    </div>
                    <form id="upload-form" enctype="multipart/form-data">
                        <div class="form-group">
                            <input type="file" class="form-control-file border-gray-300 rounded-md px-2 py-1"
                                id="image-upload" name="image" accept="image/*" required>
                        </div>
                        <button type="submit"
                            class="btn btn-primary btn-block bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md">
                            <i class="fas fa-upload mr-2"></i> Upload
                        </button>
                    </form>
                    <div class="result-area" id="result-area">
                        <input type="text" class="result-input" id="result-link-input" readonly>
                        <button class="btn btn-secondary" id="copy-button">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                    </div>
                </div>
                <div class="text-center mt-3">
                    <a href="/api-docs" class="btn btn-outline-info">View API Docs</a>
                </div>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.32/dist/sweetalert2.all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/i18next/23.6.0/i18next.min.js"></script>
      <script>
         const form = document.getElementById('upload-form');
        const imageInput = document.getElementById('image-upload');
        const resultDiv = document.getElementById('result-area');
        const resultLinkInput = document.getElementById('result-link-input');
        const progressDiv = document.getElementById('upload-progress');
        const progressBar = progressDiv.querySelector('.progress-bar');
        const copyButton = document.getElementById('copy-button');
        const skeletonContainer = document.getElementById('skeleton-container')
        const mainContainer = document.querySelector('.container:not(#skeleton-container)')
         const progressBarTween = gsap.to(progressBar, {
        duration: 1,
        width: '100%',
        ease: 'power2.out',
        paused: true,
        onUpdate: function(){
          progressBar.textContent = `${Math.round(this.progress() * 100)}%`
        },
        onComplete: function(){
         progressBar.textContent = "100%"
        }
      });

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(form);
             skeletonContainer.style.display = 'block';
             mainContainer.style.display = 'none';
            progressDiv.style.display = 'block';
            resultDiv.style.display = 'none';
             progressBar.style.width = '0%';
          progressBarTween.play(0);
            try {
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData,
                });
                if (!response.ok) {
                    const errorData = await response.json();
                     console.error('Upload failed with status:', response.status, 'and message:', errorData);
                        throw new Error(`Upload Gagal: ${response.status} - ${errorData.error || 'Unknown error'}`);
                }
                const data = await response.json();
                 if (data && data.src) {
                    resultLinkInput.value = data.src;
                  resultDiv.style.display = 'flex';
                 Swal.fire({
                    icon: 'success',
                    title: i18next.t('upload_success'),
                  });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: i18next.t('upload_fail')
                    })
                  resultDiv.style.display = 'none';
                }
            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error!',
                    text: i18next.t('upload_error') + error.message,
                })
                resultDiv.style.display = 'none';
            } finally {
                 progressBarTween.pause(0);
                 progressDiv.style.display = 'none';
                  skeletonContainer.style.display = 'none';
                  mainContainer.style.display = 'block';
            }

        });

      copyButton.addEventListener('click', () => {
          resultLinkInput.select();
           document.execCommand('copy');
         Swal.fire({
             icon: 'success',
              title: 'Link Copied!'
           })
      })

        imageInput.addEventListener('change', function (event) {
            const file = event.target.files[0];
            if (file) {
                const filesize = file.size / 1024;
                if (filesize > 20048) {
                    alert("Ukuran File terlalu Besar, Max 20 MB!");
                    imageInput.value = "";
                }
            }
        });
       AOS.init();
       i18next.init({
            lng: 'en',
             resources: {
              en: {
              translation: {
               upload_success: 'UPLOAD SUCCESSFUL',
               upload_fail: 'Upload Failed, No Link Returned!',
               upload_error: 'Error during upload:'
               }
              }
             }
        });

    </script>
</body>

</html>
